process {
    withName: STAR_ALIGN_CX {
        ext.args = {[
            '--chimSegmentMin 10',
            '--limitBAMsortRAM 512000000000'
        ].join(' ').trim()}
    }
    withName: 'STAR_ALIGN_DCC_PAIR' {
        ext.prefix = {"${meta.id}_bothreads"}
    }
    withName: 'STAR_ALIGN_DCC_R1' {
        ext.prefix = {"${meta.id}_read1"}
    }
    withName: 'STAR_ALIGN_DCC_R2' {
        ext.prefix = {"${meta.id}_read2"}
    }
    withName: 'STAR_ALIGN_CX' {
        ext.prefix = {"${meta.id}_cx"}
    }
    withName: 'STAR_ALIGN_DCC.*' {
        ext.args = {[
            '--outSAMtype BAM SortedByCoordinate',
            '--outReadsUnmapped Fastx',
            '--outSJfilterOverhangMin 15 15 15 15',
            '--alignSJoverhangMin 15',
            '--alignSJDBoverhangMin 15',
            '--seedSearchStartLmax 30',
            '--outFilterMultimapNmax 20',
            '--outFilterScoreMin 1',
            '--outFilterMatchNmin 1',
            '--outFilterMismatchNmax 2',
            '--chimSegmentMin 15',
            '--chimScoreMin 15',
            '--chimScoreSeparation 10',
            '--chimJunctionOverhangMin 15',
            '--limitBAMsortRAM 512000000000',
        ].join(' ').trim()}
    }
    withName: DCC_MAIN {
        stageInMode = 'copy'
    }
    withName: BOWTIE2_ALIGN_PRIMARY {
        ext.prefix = {"${meta.id}_fc"}
        ext.args = {[
            '--very-sensitive',
            '--mm',
            '--score-min=C,-15,0',
        ].join(' ').trim()}
        ext.args2 = {[
            '--write-index',
        ].join(' ').trim()}
    }
    withName: SAMTOOLS_VIEW {
        ext.prefix = {"${meta.id}_unmapped"}
        ext.args = {[
            '-hf 4',
            '--write-index',
        ].join(' ').trim()}
        ext.args2 = {[
        ].join(' ').trim()}
    }
    withName: FINDCIRC_MAIN { 
        ext.args = {[
            '--reorder',
            '--mm',
            '--score-min=C,-15,0',
            '-q',
        ].join(' ').trim()}
        ext.args2 = {[
        ].join(' ').trim()}
    }
    withName: FINDCIRC_OUTREADER {
        ext.args = {[
            '-strict 0',
        ].join(' ').trim()}
    }
    withName: 'CIRCSNAKE_MATRIXTWO.*' {
        ext.args = {[
            '--exclude_circbank 1',
        ].join(' ').trim()}
    }
    withName: 'CIRCSNAKE_MATRIXTWO_DCC' {
        ext.prefix = {"${meta.id}_dcc"}
    }
    withName: 'CIRCSNAKE_MATRIXTWO_FC' {
        ext.prefix = {"${meta.id}_fc"}
    }
    withName: 'CIRCSNAKE_MATRIXTWO_CX' {
        ext.prefix = {"${meta.id}_cx"}
    }
    withName: 'CIRCSNAKE_NORM' {
        ext.prefix = {"$voted_circs.baseName"}
    }
}
